<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3PL KPI Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Dark Gray */
            color: #f9fafb; /* Light Gray */
        }
        .kpi-card {
            background-color: #1f2937; /* Gray-800 */
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.2), 0 4px 6px -4px rgb(0 0 0 / 0.2);
        }
        .kpi-title {
            color: #9ca3af; /* Gray-400 */
            font-weight: 500;
        }
        .kpi-value {
            font-size: 2.25rem;
            font-weight: 700;
            color: #f9fafb;
        }
        .kpi-change {
            display: flex;
            align-items: center;
            font-weight: 500;
        }
        .text-green-400 { color: #4ade80; }
        .text-red-400 { color: #f87171; }
        .chart-container {
            position: relative;
            flex-grow: 1;
            min-height: 120px;
        }
        /* Sidebar Styles */
        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            color: #d1d5db; /* Gray-300 */
            transition: background-color 0.2s, color 0.2s;
        }
        .sidebar-link:hover {
            background-color: #374151; /* Gray-700 */
            color: #ffffff;
        }
        .sidebar-link.active {
            background-color: #4f46e5; /* Indigo-600 */
            color: #ffffff;
            font-weight: 600;
        }
    </style>
</head>
<body class="overflow-x-hidden">

    <div class="flex h-screen bg-gray-900">
        <!-- Collapsible Sidebar -->
        <aside id="sidebar" class="w-64 bg-gray-800 text-white flex-shrink-0 transition-all duration-300 ease-in-out -translate-x-full sm:translate-x-0">
            <div class="p-6">
                <h2 class="text-2xl font-bold">3PL KPIs</h2>
            </div>
            <nav class="mt-4 px-4 space-y-2">
                <a href="#" class="sidebar-link active" data-target="panel-overview">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                    Overview
                </a>
                <a href="#" class="sidebar-link" data-target="panel-client-performance">
                     <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    Client Performance
                </a>
                <a href="#" class="sidebar-link" data-target="panel-inventory">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path></svg>
                    Inventory
                </a>
                <a href="#" class="sidebar-link" data-target="panel-operations">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                    Operations
                </a>
                 <a href="#" class="sidebar-link" data-target="panel-costs">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    Costs & Profitability
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="bg-gray-800 shadow p-4 flex items-center">
                <button id="menu-toggle" class="text-white sm:hidden">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
                <div class="ml-4">
                    <h1 class="text-xl font-bold text-white">3PL Operations Dashboard</h1>
                </div>
            </header>
            
            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-900 p-4 sm:p-6 lg:p-8">
                <!-- KPI Panels Container -->
                <div id="panel-overview" class="kpi-panel">
                    <h2 class="text-2xl font-bold mb-4">Aggregated Performance Overview</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="kpi-card"><h2 class="kpi-title">Overall Order Accuracy</h2><div class="chart-container"><canvas id="overviewAccuracyChart"></canvas></div></div>
                        <div class="kpi-card"><h2 class="kpi-title">Overall On-Time Shipping</h2><div class="chart-container"><canvas id="overviewShippingChart"></canvas></div></div>
                        <div class="kpi-card"><h2 class="kpi-title">Total Orders Shipped</h2><p class="kpi-value"><span id="totalOrders">12,450</span></p><p class="kpi-change text-green-400"><span>+5%</span> vs last month</p></div>
                        <div class="kpi-card"><h2 class="kpi-title">Warehouse Capacity</h2><div class="chart-container"><canvas id="warehouseCapacityChart"></canvas></div></div>
                    </div>
                </div>

                <div id="panel-client-performance" class="kpi-panel hidden">
                    <h2 class="text-2xl font-bold mb-4">Client Performance SLAs</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="kpi-card"><h2 class="text-lg font-semibold mb-2">SLA Compliance (On-Time & Accurate)</h2><div class="chart-container"><canvas id="clientSlaChart"></canvas></div></div>
                        <div class="kpi-card"><h2 class="text-lg font-semibold mb-2">Order Volume by Client</h2><div class="chart-container"><canvas id="clientVolumeChart"></canvas></div></div>
                        <div class="kpi-card"><h2 class="text-lg font-semibold mb-2">Order Fill Rate (per Client)</h2><div class="chart-container"><canvas id="clientFillRateChart"></canvas></div></div>
                        <div class="kpi-card"><h2 class="text-lg font-semibold mb-2">Perfect Order Rate (per Client)</h2><div class="chart-container"><canvas id="clientPerfectOrderChart"></canvas></div></div>
                    </div>
                </div>

                <div id="panel-inventory" class="kpi-panel hidden">
                    <h2 class="text-2xl font-bold mb-4">Inventory Health</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="kpi-card"><h2 class="text-lg font-semibold mb-2">Inventory Accuracy by Zone</h2><div class="chart-container"><canvas id="inventoryAccuracyChartDetail"></canvas></div></div>
                        <div class="kpi-card"><h2 class="text-lg font-semibold mb-2">Inventory Shrinkage (per Client)</h2><div class="chart-container"><canvas id="inventoryShrinkageChart"></canvas></div></div>
                        <div class="kpi-card lg:col-span-2"><h2 class="text-lg font-semibold mb-2">Aging Inventory (by Client)</h2><div class="chart-container" style="min-height: 250px;"><canvas id="agingInventoryChart"></canvas></div></div>
                    </div>
                </div>

                <div id="panel-operations" class="kpi-panel hidden">
                    <h2 class="text-2xl font-bold mb-4">Operational Efficiency</h2>
                     <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Receiving -->
                        <div class="kpi-card"><h2 class="text-lg font-semibold">Receiving Efficiency</h2><p class="kpi-value"><span id="receivingEfficiencyVal">22</span></p><p class="kpi-title">Pallets/hr</p></div>
                        <!-- Put-away -->
                        <div class="kpi-card"><h2 class="text-lg font-semibold">Put-away Cycle Time</h2><p class="kpi-value"><span id="putawayCycleTime">1.8</span></p><p class="kpi-title">Hours</p></div>
                        <!-- Picking -->
                        <div class="kpi-card"><h2 class="kpi-title">Picking Accuracy</h2><div class="chart-container"><canvas id="pickingAccuracyOpsChart"></canvas></div></div>
                        <!-- Loading -->
                        <div class="kpi-card"><h2 class="text-lg font-semibold">Avg. Loading Time</h2><p class="kpi-value"><span id="loadingTime">45</span></p><p class="kpi-title">Minutes/Truck</p></div>
                        <!-- Dock-to-Stock -->
                        <div class="kpi-card"><h2 class="text-lg font-semibold">Dock-to-Stock</h2><p class="kpi-value"><span id="dockToStockVal">4.1</span></p><p class="kpi-title">Hours</p></div>
                        <!-- Safety -->
                        <div class="kpi-card"><h2 class="kpi-title">Safety</h2><p class="kpi-title mt-4">Days Since Last Accident</p><p class="kpi-value text-green-400"><span id="safetyDays">128</span></p></div>
                     </div>
                </div>
                
                <div id="panel-costs" class="kpi-panel hidden">
                    <h2 class="text-2xl font-bold mb-4">Costs & Profitability</h2>
                     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="kpi-card lg:col-span-2"><h2 class="text-lg font-semibold mb-2">Revenue vs. Cost per Client</h2><div class="chart-container" style="min-height: 250px;"><canvas id="profitabilityChart"></canvas></div></div>
                        <div class="kpi-card"><h2 class="text-lg font-semibold mb-2">Value-Added Service Profitability</h2><div class="chart-container"><canvas id="vasProfitabilityChart"></canvas></div></div>
                        <div class="kpi-card"><h2 class="text-lg font-semibold mb-2">Return Processing Cost</h2><p class="kpi-value"><span id="returnProcessingCost">$8.50</span></p><p class="kpi-title">per return</p></div>
                     </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Sidebar and Panel Logic ---
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menu-toggle');
            const navLinks = document.querySelectorAll('.sidebar-link');
            const panels = document.querySelectorAll('.kpi-panel');

            menuToggle.addEventListener('click', () => sidebar.classList.toggle('-translate-x-full'));
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('data-target');
                    navLinks.forEach(navLink => navLink.classList.remove('active'));
                    link.classList.add('active');
                    panels.forEach(panel => panel.id === targetId ? panel.classList.remove('hidden') : panel.classList.add('hidden'));
                    if (window.innerWidth < 640) sidebar.classList.add('-translate-x-full');
                });
            });

            // --- Chart Helpers ---
            const createDonutChart = (ctx, initialData, isPercentage = true) => {
                const centerText = {id: 'centerText', afterDraw(chart) {const { ctx, chartArea: { width, height, left, top } } = chart; ctx.save(); const text = isPercentage ? parseFloat(chart.data.datasets[0].data[0]).toFixed(1) + '%' : chart.data.datasets[0].data[0]; ctx.font = 'bold 24px Inter'; ctx.fillStyle = '#f9fafb'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText(text, width / 2 + left, height / 2 + top); ctx.restore();}};
                const data = isPercentage ? [initialData, 100 - initialData] : [initialData, 0];
                return new Chart(ctx, {type: 'doughnut', data: {datasets: [{data: data, backgroundColor: ['#34d399', '#374151'], borderWidth: 0, cutout: '75%'}]}, options: {responsive: true, maintainAspectRatio: false, plugins: {legend: { display: false }, tooltip: { enabled: false }}}, plugins: [centerText]});
            };
            const chartOptions = (legendDisplay = false, yStacked = false, xStacked = false, indexAxis = 'x') => ({responsive: true, indexAxis: indexAxis, maintainAspectRatio: false, plugins: { legend: { display: legendDisplay, labels: { color: '#d1d5db' }, position: 'top' } }, scales: {y: {beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.1)'}, ticks: { color: '#9ca3af' }, stacked: yStacked}, x: {grid: { display: false }, ticks: { color: '#9ca3af' }, stacked: xStacked}}});

            // --- Chart Initialization ---
            const overviewAccuracyChart = createDonutChart(document.getElementById('overviewAccuracyChart').getContext('2d'), 99.1);
            const overviewShippingChart = createDonutChart(document.getElementById('overviewShippingChart').getContext('2d'), 98.2);
            const warehouseCapacityChart = createDonutChart(document.getElementById('warehouseCapacityChart').getContext('2d'), 85);
            
            const clientSlaChart = new Chart(document.getElementById('clientSlaChart').getContext('2d'), {type: 'bar', data: {labels: ['Client A', 'Client B', 'Client C', 'Client D'], datasets: [{label: 'On-Time', data: [99.5, 97.2, 98.8, 99.1], backgroundColor: '#34d399'}, {label: 'Accurate', data: [99.8, 99.1, 99.5, 99.6], backgroundColor: '#60a5fa'}]}, options: chartOptions(true)});
            const clientVolumeChart = new Chart(document.getElementById('clientVolumeChart').getContext('2d'), {type: 'doughnut', data: {labels: ['Client A', 'Client B', 'Client C', 'Client D', 'Other'], datasets: [{data: [4500, 3200, 2800, 1950, 1200], backgroundColor: ['#60a5fa', '#34d399', '#a78bfa', '#f87171', '#fb923c']}]}, options: {responsive: true, maintainAspectRatio: false, plugins: { legend: { display: true, position: 'top', labels: { color: '#d1d5db'}}}}});
            const clientFillRateChart = new Chart(document.getElementById('clientFillRateChart').getContext('2d'), {type: 'bar', data: {labels: ['Client A', 'Client B', 'Client C', 'Client D'], datasets: [{label: 'Fill Rate %', data: [99.2, 98.5, 99.8, 97.9], backgroundColor: '#a78bfa'}]}, options: chartOptions(false, false, false, 'y')});
            const clientPerfectOrderChart = new Chart(document.getElementById('clientPerfectOrderChart').getContext('2d'), {type: 'bar', data: {labels: ['Client A', 'Client B', 'Client C', 'Client D'], datasets: [{label: 'Perfect Order %', data: [97.5, 95.1, 98.2, 96.5], backgroundColor: '#fb923c'}]}, options: chartOptions(false, false, false, 'y')});

            const inventoryAccuracyChartDetail = new Chart(document.getElementById('inventoryAccuracyChartDetail').getContext('2d'), {type: 'bar', data: {labels: ['Zone A', 'Zone B', 'Zone C', 'Zone D'], datasets: [{label: 'Accuracy %', data: [99.8, 98.9, 99.5, 99.1], backgroundColor: ['#34d399', '#f87171', '#34d399', '#34d399']}]}, options: chartOptions(false, false, false, 'y')});
            const inventoryShrinkageChart = new Chart(document.getElementById('inventoryShrinkageChart').getContext('2d'), {type: 'bar', data: {labels: ['Client A', 'Client B', 'Client C', 'Client D'], datasets: [{label: 'Shrinkage ($)', data: [250, 450, 150, 300], backgroundColor: '#f87171'}]}, options: chartOptions()});
            const agingInventoryChart = new Chart(document.getElementById('agingInventoryChart').getContext('2d'), {type: 'bar', data: {labels: ['Client A', 'Client B', 'Client C'], datasets: [{label: '0-30 Days', data: [80, 70, 85], backgroundColor: '#34d399'}, {label: '31-90 Days', data: [15, 25, 10], backgroundColor: '#fb923c'}, {label: '>90 Days', data: [5, 5, 5], backgroundColor: '#f87171'}]}, options: chartOptions(true, true, true)});
            
            const pickingAccuracyOpsChart = createDonutChart(document.getElementById('pickingAccuracyOpsChart').getContext('2d'), 99.4);
            
            const profitabilityChart = new Chart(document.getElementById('profitabilityChart').getContext('2d'), {type: 'bar', data: {labels: ['Client A', 'Client B', 'Client C', 'Client D'], datasets: [{label: 'Revenue ($K)', data: [120, 95, 80, 65], backgroundColor: '#34d399'}, {label: 'Cost to Serve ($K)', data: [95, 85, 72, 60], backgroundColor: '#f87171'}]}, options: chartOptions(true)});
            const vasProfitabilityChart = new Chart(document.getElementById('vasProfitabilityChart').getContext('2d'), {type: 'bar', data: {labels: ['Kitting', 'Labeling', 'Returns'], datasets: [{label: 'Profit Margin %', data: [35, 55, 25], backgroundColor: ['#60a5fa', '#34d399', '#a78bfa']}]}, options: chartOptions()});

            // --- Dynamic Data Simulation ---
            const fluctuate = (value, amount) => value + (Math.random() - 0.5) * amount;
            setInterval(() => {
                // Update text values
                document.getElementById('receivingEfficiencyVal').textContent = Math.round(fluctuate(22, 2));
                document.getElementById('putawayCycleTime').textContent = fluctuate(1.8, 0.2).toFixed(1);
                document.getElementById('loadingTime').textContent = Math.round(fluctuate(45, 3));
                document.getElementById('dockToStockVal').textContent = fluctuate(4.1, 0.3).toFixed(1);

                 // Update charts with new data points
                [clientSlaChart, profitabilityChart, clientFillRateChart, clientPerfectOrderChart, inventoryShrinkageChart].forEach(chart => {
                    chart.data.datasets.forEach(dataset => {
                        dataset.data = dataset.data.map(d => fluctuate(d, d * 0.01));
                    });
                    chart.update();
                });
                agingInventoryChart.data.datasets.forEach(dataset => {
                    dataset.data = dataset.data.map(d => fluctuate(d, d * 0.02));
                });
                agingInventoryChart.update();
                
                let newPickingOps = fluctuate(99.4, 0.2);
                pickingAccuracyOpsChart.data.datasets[0].data = [newPickingOps, 100 - newPickingOps];
                pickingAccuracyOpsChart.update();

            }, 3000);
        });
    </script>

</body>
</html>
